### Account Service API Test Collection
### Base URL: http://localhost:3001
### Description: Test all authentication and user management endpoints

@baseUrl = http://localhost:3001
@contentType = application/json

### Variables (will be set from responses)
# @accessToken = <set from login response>
# @refreshToken = <set from login response>

###############################################################################
# Health & Status
###############################################################################

### Health Check
GET {{baseUrl}}/health
Accept: {{contentType}}

### Root Endpoint
GET {{baseUrl}}/
Accept: {{contentType}}

###############################################################################
# Authentication - Registration & Login
###############################################################################

### Register New User
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "Test@1234",
  "confirmPassword": "Test@1234",
  "fullName": "Test User"
}

### Register Another User
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "username": "john_doe",
  "email": "john.doe@example.com",
  "password": "SecureP@ss123",
  "confirmPassword": "SecureP@ss123",
  "fullName": "John Doe"
}

### Login (Get Access Token)
# @name login
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "email": "test@example.com",
  "password": "Test@1234",
  "rememberMe": false
}

### Login with Invalid Credentials (Should Fail)
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "email": "test@example.com",
  "password": "WrongPassword",
  "rememberMe": false
}

###############################################################################
# Token Management
###############################################################################

### Refresh Access Token
POST {{baseUrl}}/api/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "{{refreshToken}}"
}

### Get Current User Info (Requires Authentication)
GET {{baseUrl}}/api/auth/me
Accept: {{contentType}}
Authorization: Bearer {{accessToken}}

###############################################################################
# Password Management
###############################################################################

### Request Password Reset
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: {{contentType}}

{
  "email": "test@example.com"
}

### Reset Password with Token
POST {{baseUrl}}/api/auth/reset-password
Content-Type: {{contentType}}

{
  "token": "your-reset-token-here",
  "newPassword": "NewP@ssw0rd123",
  "confirmPassword": "NewP@ssw0rd123"
}

### Change Password (Requires Authentication)
POST {{baseUrl}}/api/auth/change-password
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "currentPassword": "Test@1234",
  "newPassword": "NewP@ssw0rd456",
  "confirmPassword": "NewP@ssw0rd456"
}

###############################################################################
# Email Verification
###############################################################################

### Verify Email with Token
GET {{baseUrl}}/api/auth/verify-email?token=your-verification-token-here
Accept: {{contentType}}

###############################################################################
# Logout
###############################################################################

### Logout (Revoke Refresh Token)
POST {{baseUrl}}/api/auth/logout
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "refreshToken": "{{refreshToken}}"
}

###############################################################################
# Error Cases & Validation Tests
###############################################################################

### Register with Missing Fields (Should Fail)
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "username": "testuser2",
  "email": "test2@example.com"
}

### Register with Invalid Email (Should Fail)
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "username": "testuser3",
  "email": "invalid-email",
  "password": "Test@1234",
  "confirmPassword": "Test@1234"
}

### Register with Weak Password (Should Fail)
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "username": "testuser4",
  "email": "test4@example.com",
  "password": "weak",
  "confirmPassword": "weak"
}

### Register with Mismatched Passwords (Should Fail)
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "username": "testuser5",
  "email": "test5@example.com",
  "password": "Test@1234",
  "confirmPassword": "Different@1234"
}

### Login without Authentication (Should Fail)
GET {{baseUrl}}/api/auth/me
Accept: {{contentType}}

### Refresh with Invalid Token (Should Fail)
POST {{baseUrl}}/api/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "invalid-token-here"
}

###############################################################################
# Usage Notes
###############################################################################

# 1. Start with Health Check to verify service is running
# 2. Register a new user
# 3. Check email (or logs) for verification token
# 4. Verify email using the token
# 5. Login to get access token and refresh token
# 6. Use access token in Authorization header for protected endpoints
# 7. When access token expires, use refresh token to get new tokens
# 8. To logout, call logout endpoint with refresh token

# Token Format:
# - Access Token: Short-lived (1 hour), use in Authorization: Bearer <token>
# - Refresh Token: Long-lived (7 days), use to get new access tokens

# Password Requirements:
# - Minimum 8 characters
# - At least one uppercase letter
# - At least one lowercase letter
# - At least one digit
# - At least one special character

# Rate Limiting (configured but not yet enforced):
# - Login: 10 attempts per 15 minutes
# - Register: 5 attempts per hour
# - Password Reset: 5 attempts per hour

###############################################################################
# Sample Success Responses
###############################################################################

# Register Response:
# {
#   "success": true,
#   "data": {
#     "userId": 1,
#     "username": "testuser",
#     "email": "test@/example.com",
#     "message": "Registration successful. Please verify your email."
#   }
# }

# Login Response:
# {
#   "success": true,
#   "data": {
#     "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
#     "refreshToken": "base64-encoded-token",
#     "tokenType": "Bearer",
#     "expiresIn": 3600,
#     "user": {
#       "id": 1,
#       "username": "testuser",
#       "email": "test@/example.com",
#       "rating": 1500,
#       "isVerified": false,
#       "roles": ["user"]
#     }
#   }
# }

# Error Response:
# {
#   "success": false,
#   "message": "Email is already registered",
#   "errors": null
# }

###
